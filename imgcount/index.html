<html>
<head>
<title>imgcount</title>
<style type="text/css">
body {
  background: #000;
  color: #fff;
  font-family: sans-serif;
}
#main {
  width: 650px;
  margin-left: auto;
  margin-right: auto;
  margin-top: 60px;
}
form {
  margin-top: 240px;
}
</style>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript" src="jquery.url.js"></script>
<script type="text/javascript">
var dir, num, cur = -1, intid;
var buf = {};

var loadimg = function(idx) {
  if (idx < 0) return;
  console.debug("loadimg", idx);
  $.getJSON('http://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=49f95216302b6abb8fef8968d68853be&format=json&sort=relevance&tags=number,' + idx + '&tag_mode=all&jsoncallback=?', function(data) {
    var photo = data.photos.photo[0];
    var url = 'http://farm' + photo.farm + '.staticflickr.com/' + photo.server + '/' + photo.id +'_' + photo.secret + '_z.jpg';
    $('<img/>')[0].src = url;
    buf[idx] = url;
  });
}

var setimg = function(idx) {
  console.debug("setimg", idx);
  $('img').attr('src', buf[idx]);
}

var update = function() {
  if (dir == "down") {
    if (cur == -1) {
      cur = num;
      loadimg(cur);
      loadimg(cur-1);
      loadimg(cur-2);
      loadimg(cur-3);
      loadimg(cur-4);
    }
    if (cur == 0) {
      window.clearInterval(intid);
    }
    loadimg(cur-5);
    setimg(cur);
    cur--;
  }
  if (dir == "up") {
    if (cur == -1) {
      cur = 0;
      loadimg(cur);
      loadimg(cur+1);
      loadimg(cur+2);
      loadimg(cur+3);
      loadimg(cur+4);
    }
    if (cur == num) {
      window.clearInterval(intid);
    }
    loadimg(cur+5);
    setimg(cur);
    cur++;
  }
}

$(function(){
  dir = $.url.param('dir');
  num = parseInt($.url.param('num'));
  if (!dir || !num) {
    $('#main').html('<form action="">enter number (e.g. 300):<p/><input name="num" /><p/><select name="dir"><option value="down">count-down</option><option value="up">count-up</option></select><p/><input value="start!" type="submit"></form>');
  } else {
    intid = window.setInterval(update, 1000);
  }
});
</script>
</head>

<body>

<div id="main"><img /></div>

</body>
</html>
